# Proxy AI Backend

Backend for Proxy – an AI twin networking platform. Personas are extracted from voice interviews, AI group conversations are generated, and the API serves conversations, human chat, matches, and personas.

## Setup

1. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

2. **Environment**
   - Copy `.env.example` to `.env`
   - Add your Anthropic API key: `ANTHROPIC_API_KEY=your_api_key_here`

3. **Create personas from interviews**
   - Place interview JSON files in `interviews/` (see format below).
   - Extract a personality:
   ```bash
   python create_persona.py interviews/interview_sarah_20260214.json
   ```
   - Repeat for each interview. Personas are saved under `personas/`.

4. **Generate conversations**
   - Requires at least 3 personas in `personas/`.
   ```bash
   python generate_conversations.py
   ```
   - Creates `conversations/sports.json`, `conversations/ai.json`, `conversations/tech.json`, and `matches.json`.

5. **Start the server**
   ```bash
   uvicorn main:app --reload
   ```
   - **App:** http://localhost:8000 (simple frontend)
   - **API:** http://localhost:8000/docs  
   - **Health:** http://localhost:8000/health  

## Interview JSON format

Input for `create_persona.py` should look like:

```json
{
  "user_name": "Sarah",
  "conversation": [
    {"question": "...", "answer": "...", "timestamp": "..."}
  ],
  "completed_at": "..."
}
```

`timestamp` is optional; `question` and `answer` are used to build the transcript.

## Testing

- **Health check**
  ```bash
  curl http://localhost:8000/health
  ```

- **Get AI conversation**
  ```bash
  curl http://localhost:8000/api/conversations/ai
  ```

- **Send human message**
  ```bash
  curl -X POST http://localhost:8000/api/conversations/human \
    -H "Content-Type: application/json" \
    -d '{"speaker":"Sarah","text":"Hello!"}'
  ```

- **Get matches**
  ```bash
  curl http://localhost:8000/api/matches
  ```

- **Get personas**
  ```bash
  curl http://localhost:8000/api/personas
  ```

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Health check |
| GET | `/api/conversations/sports` | Sports group conversation |
| GET | `/api/conversations/ai` | AI group conversation |
| GET | `/api/conversations/tech` | Tech group conversation |
| GET | `/api/conversations/human` | Human-only chat messages |
| POST | `/api/conversations/human` | Send a message (body: `{"speaker","text"}`) |
| DELETE | `/api/conversations/human` | Clear human chat |
| GET | `/api/matches` | All persona matches (by score) |
| GET | `/api/personas` | All personas |

## Project layout

```
backend/
├── create_persona.py       # Extract persona from interview JSON
├── generate_conversations.py  # Generate Sports/AI/Tech convos + matches
├── main.py                 # FastAPI app (serves API + frontend)
├── requirements.txt
├── static/                 # Simple frontend (HTML/CSS/JS)
│   ├── index.html
│   ├── styles.css
│   └── app.js
├── personas/               # Persona JSON files (from create_persona.py)
├── conversations/          # sports.json, ai.json, tech.json, human.json
├── interviews/             # Interview JSON inputs
├── matches.json            # Generated by generate_conversations.py
└── README.md
```
